# ZFS 备份系统

## 项目介绍

ZFS 备份系统是一个用于自动化 ZFS 数据集备份的脚本集合。它提供了简单的安装、配置和管理界面，支持本地和远程备份，并集成了 Telegram 通知功能。

### 主要特性

- 自动化 ZFS 数据集备份
- 支持本地和远程备份
- 增量备份功能
- Telegram 通知集成
- 用户友好的配置界面
- 自动清理旧快照
- 安全的 SSH 密钥管理

## 系统要求

- 支持的操作系统：Debian、Ubuntu、Arch Linux、Gentoo
- ZFS 文件系统
- systemd
- 必要的依赖：rsync, curl, yq, dialog（脚本会自动尝试安装这些依赖）

## 安装指南

1. 克隆仓库：
   ```
   git clone https://github.com/lbsyzfs/zfs-backup
   ```

2. 进入项目目录：
   ```
   chmod +x -R zfs-backup
   cd zfs-backup
   ```

3. 运行安装脚本：
   ```
   sudo ./zfs_backup_manager.sh
   ```

4. 按照提示完成配置。

## 使用说明

安装完成后，可以通过以下命令管理备份系统：

```
sudo zfs_backup_manager.sh
```

这个命令会打开一个交互式菜单，您可以通过它来：

- 修改配置
- 手动触发备份
- 查看备份日志
- 卸载备份系统

## 配置说明

主要配置项包括：

- 源数据集：要备份的本地 ZFS 数据集
- 远程主机：接收备份的远程主机信息
- 远程数据集：远程主机上用于存储备份的数据集
- 快照保留策略：本地保留的快照数量
- Telegram 通知设置（可选）

详细的配置说明可以在安装过程中或通过配置菜单查看。

## 安全考虑

- 脚本使用受限的 SSH 密钥来执行远程操作，仅允许必要的 ZFS 命令。
- 所有敏感信息都存储在受保护的配置文件中。
- 建议在使用前审查脚本内容，确保符合您的安全要求。

## 故障排除

如果遇到问题，请检查以下几点：

1. 确保所有依赖都已正确安装。
2. 检查 ZFS 数据集权限。
3. 验证 SSH 连接和远程主机配置。
4. 查看 `/var/log/zfs_backup.log` 中的日志信息。
